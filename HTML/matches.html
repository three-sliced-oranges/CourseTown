<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="../CSS/style.css"/>
	</head>
	<body>
		<ul id="navbar">
			<li id="navbarlist"><a href="contact.html">Contact</a> </li>
			<li id="navbarlist"><a href="Matches.html">Matches</a> </li>
			<li id="navbarlist"><a href="explore.html">Explore</a> </li>
			<li id="navbarlist"><a href="myprofile.html">My Profile</a> </li>
			<li id="navbarlist"><a href="about.html">About</a> </li>
			<li id="navbarlist"><a href="home.html">Home</a> </li>
		</ul>
		<br>
		<br>
		<br>
		<div align="center">
			<table width =1250>
				<col width = 300>
				<col width = 400>
				<tr align = "center">
					<th><h1>Personal</h1></th>
					<th><h1>Select Period</h1></th>
					<th><h1>Matches</h1></th>
				</tr>
				<tr align = "center">
					<td> 
						<form> 
							<p> Full Name: <input type="text" size="15" id = "name"> </p>
						</form>
					</td>
					<td>
						<form>
							<input type="radio" name="period" id="p1"> Period 1 
							<input type="radio" name="period" id="p2"> Period 2 
							<input type="radio" name="period" id="p3"> Period 3 
							<input type="radio" name="period" id="p4"> Period 4 
						</form>
					</td>
					<td> 
						<button onclick="match()">Find Matches</button>
					</td>
				</tr>
			</table> 
			<p id=nomatch> </p>
		</div>
		
		
		<div id = "explore" class="grid-container">
		</div>


		<script src="https://www.gstatic.com/firebasejs/5.10.1/firebase.js"></script>
		<script>

		  	// Initialize Firebase
		 	var config = {
			    apiKey: "AIzaSyAt_-_1I9ISW4PmF1DgW_03wO9PLdJ10uE",
			    authDomain: "coursetown-cfe36.firebaseapp.com",
			    databaseURL: "https://coursetown-cfe36.firebaseio.com",
			    projectId: "coursetown-cfe36",
			    storageBucket: "coursetown-cfe36.appspot.com",
			    messagingSenderId: "141311531998"
		 	};
		  	firebase.initializeApp(config);
		  	
		  	var students = [];

		  	var offered1 = [];
		  	var offered2 = [];
		  	var offered3 = [];
		  	var offered4 = [];

		  	var desired1 = []; 
		  	var desired2 = []; 
		  	var desired3 = []; 
		  	var desired4 = []; 

		  	var usersRef = firebase.database().ref("Students").orderByKey();
		  	usersRef.once('value')
		  		.then(function(snapshot) {
		  			snapshot.forEach(function(childSnapshot) {

		  				/*Collecting student names*/
		  				var name = childSnapshot.key;
		  				
		  				/*Collecting offered and desired courses based on period*/
		  				var p1o = snapshot.child(name + "/Offered/Period_1").val();
		  				var p2o = snapshot.child(name + "/Offered/Period_2").val();
		  				var p3o = snapshot.child(name + "/Offered/Period_3").val();
		  				var p4o = snapshot.child(name + "/Offered/Period_4").val();
		  				

		  				var p1d = snapshot.child(name + "/Desired/Period_1").val();
		  				var p2d = snapshot.child(name + "/Desired/Period_2").val();
		  				var p3d = snapshot.child(name + "/Desired/Period_3").val();
		  				var p4d = snapshot.child(name + "/Desired/Period_4").val();
		  				
		  				/*Add values to their list*/
		  				students.push(name);

		  				offered1.push(p1o);
		  				offered2.push(p2o);
		  				offered3.push(p3o);
		  				offered4.push(p4o);

		  				desired1.push(p1d);
		  				desired2.push(p2d);
		  				desired3.push(p3d);
		  				desired4.push(p4d);
		  			});

		  			var i;
					for (i = 0; i < students.length; i++) {
						if (offered1[i] != "") {
				  			offered = offered1[i];
				  			desired = desired1[i];
				  			period = " (Period 1)";
				  		}
				  		else if (offered2[i] != "") {
				  			offered = offered2[i];
				  			desired = desired2[i];
				  			period = " (Period 2)";
				  		}
				  		else if (offered3[i] != "") {
				  			offered = offered3[i];
				  			desired = desired3[i];
				  			period = " (Period 3)";
				  		}
				  		else if (offered4[i] != "") {
				  			offered = offered4[i];
				  			desired = desired4[i];
				  			period = " (Period 4)";
				  		}
				  		else {
				  			offered = "N/A";
				  			desired = "N/A";
				  			period = "";
				  		}
				  		document.getElementById("explore").innerHTML += "<div class=\"grid-item\">" + students[i] + period + "<br><br>Offered: " + offered + "<br>Desired: " + desired + "</div>";
				  	}	
		  		});

		  	function match() {

		  		document.getElementById("explore").innerHTML = "";
		  		document.getElementById("nomatch").innerHTML = "";
		  		var name = document.getElementById("name").value;

		  		/*Checks to see which period was selected*/
		  		if (document.getElementById("p1").checked == true) {
		  			var period = 1;
		  		} else if (document.getElementById("p2").checked == true) {
		  			var period = 2;
		  		} else if (document.getElementById("p3").checked == true) {
		  			var period = 3;
		  		} else if (document.getElementById("p4").checked == true) {
		  			var period = 4;
		  		}

		  		/*Finds user's desired course*/
		  		var ref = firebase.database().ref("Students/" + name);
		  			ref.once('value')
		  				.then(function(snapshot) {
		  					
		  					desired = snapshot.child("Desired/Period_1").val();
		 					offermatch = [];
		  					/*Matches it with one of the offered courses available*/
		  					if (period == 1) {
		  						desired = snapshot.child("Desired/Period_1").val();
		  						period = " (Period 1)";
			  					var i;
						  		for (i = 0; i < offered1.length; i++) {
						  			if (offered1[i] != "" && offered1[i] == desired) {
						  				offermatch.push(i);
						  			}
						  		}
						  		for (i = 0; i < offermatch.length; i++) {
						  			document.getElementById("explore").innerHTML += "<div class=\"grid-item\">" + students[offermatch[i]] + period + "<br><br>Offered: " + offered1[offermatch[i]] + "<br>Desired: " + desired1[offermatch[i]] + "</div>";
						  		}
					  		}

					  		else if (period == 2) {
					  			desired = snapshot.child("Desired/Period_2").val();
					  			period = " (Period 2)";
			  					var i;
						  		for (i = 0; i < offered2.length; i++) {
						  			if (offered2[i] != "" && offered2[i] == desired ) {
						  				offermatch.push(i);
						  			}
						  		}
						  		for (i = 0; i < offermatch.length; i++) {
						  			document.getElementById("explore").innerHTML += "<div class=\"grid-item\">" + students[offermatch[i]] + period + "<br><br>Offered: " + offered2[offermatch[i]] + "<br>Desired: " + desired2[offermatch[i]] + "</div>";
						  		}
					  		}

					  		else if (period == 3) {
					  			desired = snapshot.child("Desired/Period_3").val();
					  			period = " (Period 3)";
			  					var i;
						  		for (i = 0; i < offered3.length; i++) {
						  			if (offered3[i] != "" && offered3[i] == desired) {
						  				offermatch.push(i);
						  			}
						  		}
						  		for (i = 0; i < offermatch.length; i++) {
						  			document.getElementById("explore").innerHTML += "<div class=\"grid-item\">" + students[offermatch[i]] + period + "<br><br>Offered: " + offered3[offermatch[i]] + "<br>Desired: " + desired3[offermatch[i]] + "</div>";
						  		}
					  		}

					  		else if (period == 4) {
					  			desired = snapshot.child("Desired/Period_4").val();
					  			period = " (Period 4)";
			  					var i;
						  		for (i = 0; i < offered4.length; i++) {
						  			if (offered4[i] != "" && offered4[i] == desired) {
						  				offermatch.push(i);
						  			}
						  		}
						  		for (i = 0; i < offermatch.length; i++) {
						  			document.getElementById("explore").innerHTML += "<div class=\"grid-item\">" + students[offermatch[i]] + period + "<br><br>Offered: " + offered4[offermatch[i]] + "<br>Desired: " + desired4[offermatch[i]] + "</div>";
						  		}  		
					  		}

					  		if (offermatch.length == 0) {
					  			document.getElementById("nomatch").innerHTML = "Sorry, no matches were found. ☹️";
					  		}
					  		
		  				});	
		  	}
		  </script>	  	
	</body>
</html>